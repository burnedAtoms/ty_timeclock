datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id    String @id @default(cuid())
  notionUser NotionUser?
  firstname String
  surname String
  username String
  email String @unique
  allowNotionAccess Boolean @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  password Password?

  @@unique([username,email])
}

model Password {
  hash String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  userId String @unique
}

model Task {
  id Int @unique @default(autoincrement())
  taskId String @unique
  taskname String
  status String @default("Not started")
  project String?
  createdAt DateTime @default(now())
  startedAt DateTime?
  endedAt DateTime?
  totalTime String?
  assignee NotionUser @relation(fields: [assigneeId], references: [ownerId])
  assigneeId String
  @@unique([taskId,taskname])
}

model TimeLog {
  id String @id @default(cuid())
  userId String @unique
  userName String
  logEntry DateTime @default(now())
  taskId String @unique
  taskName String
  taskStartedAt DateTime
  taskEndedAt DateTime
}

model NotionUser{
  user User @relation(fields: [userId], references: [id])
  tasks Task[]
  createdAt DateTime @default(now())
  userId String @unique
  accessToken String @unique
  botId String @unique
  ownerId String @unique
  workspaceName String
  workspaceId String
  
  @@unique([botId, ownerId])
}

